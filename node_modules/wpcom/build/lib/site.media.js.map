{"version":3,"sources":["../../lib/site.media.js"],"names":[],"mappings":"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","file":"site.media.js","sourcesContent":["/**\n * Module dependencies.\n */\nconst fs = require( 'fs' );\nimport debugFactory from 'debug';\n\nconst debug = debugFactory( 'wpcom:media' );\n\n/**\n * Media methods\n *\n * @param {String} id - media id\n * @param {String} sid site id\n * @param {WPCOM} wpcom - wpcom instance\n * @return {Null} null\n */\nexport default function Media( id, sid, wpcom ) {\n\tif ( ! ( this instanceof Media ) ) {\n\t\treturn new Media( id, sid, wpcom );\n\t}\n\n\tthis.wpcom = wpcom;\n\tthis._sid = sid;\n\tthis._id = id;\n\n\tif ( ! this._id ) {\n\t\tdebug( 'WARN: media `id` is not defined' );\n\t}\n}\n\n/**\n * Get media\n *\n * @param {Object} [query] - query object parameter\n * @param {Function} fn - callback function\n * @return {Function} request handler\n */\nMedia.prototype.get = function( query, fn ) {\n\tvar path = '/sites/' + this._sid + '/media/' + this._id;\n\treturn this.wpcom.req.get( path, query, fn );\n};\n\n/**\n * Edit media\n *\n * @param {Object} [query] - query object parameter\n * @param {Object} body - body object parameter\n * @param {Function} fn - callback function\n * @return {Function} request handler\n */\nMedia.prototype.update = function( query, body, fn ) {\n\tvar path = '/sites/' + this._sid + '/media/' + this._id;\n\treturn this.wpcom.req.put( path, query, body, fn );\n};\n\n/**\n * Add media file\n *\n * @param {Object} [query] - query object parameter\n * @param {String|Object|Array} files - files to add\n * @param {Function} fn - callback function\n * @return {Function} request handler\n */\nMedia.prototype.addFiles = function( query, files, fn ) {\n\tif ( undefined === fn ) {\n\t\tif ( undefined === files ) {\n\t\t\tfiles = query;\n\t\t\tquery = {};\n\t\t} else if ( 'function' === typeof files ) {\n\t\t\tfn = files;\n\t\t\tfiles = query;\n\t\t\tquery = {};\n\t\t}\n\t}\n\n\tlet params = {\n\t\tpath: '/sites/' + this._sid + '/media/new',\n\t\tformData: []\n\t};\n\n\t// process formData\n\tfiles = Array.isArray( files ) ? files : [ files ];\n\n\tlet i, f, isStream, isFile, k, param;\n\tfor ( i = 0; i < files.length; i++ ) {\n\t\tf = files[i];\n\t\tf = 'string' === typeof f ? fs.createReadStream( f ) : f;\n\n\t\tisStream = !! f._readableState;\n\t\tisFile = 'undefined' !== typeof File && f instanceof File;\n\n\t\tdebug( 'is stream: %s', isStream );\n\t\tdebug( 'is file: %s', isFile );\n\n\t\tif ( ! isFile && ! isStream ) {\n\t\t\t// process file attributes like as `title`, `description`, ...\n\t\t\tfor ( k in f ) {\n\t\t\t\tdebug( 'add %o => %o', k, f[k] );\n\t\t\t\tif ( 'file' !== k ) {\n\t\t\t\t\tparam = 'attrs[' + i + '][' + k + ']';\n\t\t\t\t\tparams.formData.push( [ param, f[k] ] );\n\t\t\t\t}\n\t\t\t}\n\t\t\t// set file path\n\t\t\tf = f.file;\n\t\t\tf = 'string' === typeof f ? fs.createReadStream( f ) : f;\n\t\t}\n\n\t\tparams.formData.push( [ 'media[]', f ] );\n\t}\n\n\treturn this.wpcom.req.post( params, query, null, fn );\n};\n\n/**\n * Add media files from URL\n *\n * @param {Object} [query] - query object parameter\n * @param {String|Array|Object} media - files to add\n * @param {Function} fn - callback function\n * @return {Function} request handler\n */\nMedia.prototype.addUrls = function( query, media, fn ) {\n\tif ( undefined === fn ) {\n\t\tif ( undefined === media ) {\n\t\t\tmedia = query;\n\t\t\tquery = {};\n\t\t} else if ( 'function' === typeof media ) {\n\t\t\tfn = media;\n\t\t\tmedia = query;\n\t\t\tquery = {};\n\t\t}\n\t}\n\n\tlet path = '/sites/' + this._sid + '/media/new';\n\tlet body = { media_urls: [] };\n\n\t// process formData\n\tlet i, m, url, k;\n\n\tmedia = Array.isArray( media ) ? media : [ media ];\n\tfor ( i = 0; i < media.length; i++ ) {\n\t\tm = media[i];\n\n\t\tif ( 'string' === typeof m ) {\n\t\t\turl = m;\n\t\t} else {\n\t\t\tif ( ! body.attrs ) {\n\t\t\t\tbody.attrs = [];\n\t\t\t}\n\n\t\t\t// add attributes\n\t\t\tbody.attrs[i] = {};\n\t\t\tfor ( k in m ) {\n\t\t\t\tif ( 'url' !== k ) {\n\t\t\t\t\tbody.attrs[i][k] = m[k];\n\t\t\t\t}\n\t\t\t}\n\t\t\turl = m.url;\n\t\t}\n\n\t\t// push url into [media_url]\n\t\tbody.media_urls.push( url );\n\t}\n\n\treturn this.wpcom.req.post( path, query, body, fn );\n};\n\n/**\n * Delete media\n *\n * @param {Object} [query] - query object parameter\n * @param {Function} fn - callback function\n * @return {Function} request handler\n */\nMedia.prototype.delete = Media.prototype.del = function( query, fn ) {\n\tvar path = '/sites/' + this._sid + '/media/' + this._id + '/delete';\n\treturn this.wpcom.req.del( path, query, fn );\n};\n"]}